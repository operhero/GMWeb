@using Microsoft.AspNetCore.Components.Authorization
@inject NavigationManager NavigationManager

<Router AppAssembly="typeof(Program).Assembly" NotFoundPage="typeof(Pages.NotFound)">
    <Found Context="routeData">
        @{
            // 如果当前是根路径，重定向到登录页面
            if (routeData.RouteValues.TryGetValue("page", out var pageValue) && pageValue is string pageString && pageString == string.Empty)
            {
                NavigationManager.NavigateTo("/login", forceLoad: true);
                return;
            }
        }
        @if (routeData.PageType.Name.Equals("Login", StringComparison.OrdinalIgnoreCase))
        {
            <RouteView RouteData="routeData" />
            <FocusOnNavigate RouteData="routeData" Selector="h1" />
        }
        else
        {
            <AuthorizeView>
                <Authorized>
                    <RouteView RouteData="routeData" DefaultLayout="typeof(Layout.MainLayout)" />
                    <FocusOnNavigate RouteData="routeData" Selector="h1" />
                </Authorized>
                <NotAuthorized>
                    @if (!routeData.PageType.Name.Equals("Login", StringComparison.OrdinalIgnoreCase))
                    {
                        NavigationManager.NavigateTo("/login", forceLoad: true);
                    }
                </NotAuthorized>
            </AuthorizeView>
         }
    </Found>
</Router>